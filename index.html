<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSC 106 Project 3 — Japan Risk Profiles</title>

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Merriweather:wght@300;400;700&display=swap"
    rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Your existing JS (unchanged IDs) -->
  <script src="japan_map.js" type="module" defer></script>
  <script src="slider_filter.js" type="module" defer></script>
  <script src="prefecture_tooltip.js" type="module" defer></script>

  <!-- MathJax (SVG only) -->
  <script>
    window.MathJax = {
      tex: {
        packages: { '[+]': ['ams', 'text', 'textmacros'] },
        inlineMath: [['\\(', '\\)']],
        displayMath: [['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  
  <!-- Risk choropleth layer (new) -->
  <script src="risk_profile.js" type="module" defer></script>
</head>

<body>
  <div id="app">
    <!-- Header -->
    <header class="page-header card">
      <h1>Who Bears the Burden? Disaster Risk Across Japan</h1>
      <p class="subtitle">Japan • 1960–2018 • Prefecture-level risk index (human + economic impact)</p>
      <p class="subtitle"><strong>Uzair Gheewala, Odessa Castillo, Uday Lingampalli, Sean Harmon</strong> — <em>ugheewala@ucsd.edu,
                odcastillo@ucsd.edu, ulingampalli@ucsd.edu, t2harmon@ucsd.edu</em></p>
    </header>

    <!-- Controls + Filters (keeps your IDs intact) -->
    <section id="controls-row" class="card">
      <div class="control">
        <label for="myRange" id="demo">Year</label>
        <div class="control-inline">
          <button id="prevButton" type="button" class="btn">Prev</button>
          <input type="range" min="1960" max="2018" value="1960" class="slider" id="myRange" />
          <button id="nextButton" type="button" class="btn">Next</button>
          <button id="autoplay" type="button" class="btn">Play</button>
        </div>
      </div>

      <div class="control">
        <label for="myTextBox">Jump to year</label>
        <div class="control-inline">
          <input type="text" id="myTextBox" placeholder="Enter a year" />
          <button id="myButton" type="button" class="btn">Submit</button>
        </div>
      </div>

      <div class="control control--full">
        <div class="disasters">
          <span class="label">Filter by disaster type:</span>

          <label class="disaster-item">
            <input type="checkbox" id="Drought" name="Drought" checked />
            <span class="custom-checkbox"></span> Drought
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="Earthquake" name="Earthquake" checked />
            <span class="custom-checkbox"></span> Earthquake
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="ExtremeTemperature" name="ExtremeTemperature" checked />
            <span class="custom-checkbox"></span> Extreme Temperature
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="Flood" name="Flood" checked />
            <span class="custom-checkbox"></span> Flood
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="Landslide" name="Landslide" checked />
            <span class="custom-checkbox"></span> Landslide
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="Storm" name="Storm" checked />
            <span class="custom-checkbox"></span> Storm
          </label>

          <label class="disaster-item">
            <input type="checkbox" id="VolcanicActivity" name="VolcanicActivity" checked />
            <span class="custom-checkbox"></span> Volcanic Activity
          </label>
        </div>
      </div>
    </section>

    <!-- Main content area: Map + Detail -->
    <section id="main-row" class="grid">
      <!-- Map card -->
      <div id="map-container" class="card">
        <!-- <div class="card-head">
          <h2>Japan choropleth map</h2>
           <p class="card-sub">Color encodes Risk Index for the selected year</p>
        </div> -->
        <!-- Keep the same ID for your D3 map -->
        <svg id="map" aria-label="Japan risk map (D3)"></svg>
        <div id="map-legend"></div>
      </div>

      <!-- Detail card (secondary plot / per-prefecture panel) -->
      <div id="detail-container" class="card">
        <div class="card-head">
          <h2 id="detail-title">Click a prefecture to explore its profile</h2>
          <!-- <p class="card-sub">Time-series of risk, event counts, and hazard mix</p> -->
        </div>
        <!-- Your JS can target these as needed -->
        <svg id="detail-svg" aria-label="Prefecture detail chart"></svg>
        <div id="detail-summary"></div>
      </div>
    </section>

    <!-- “Writeup” now as an on-page card -->
    <section id="report" class="card">
      <h2>Write-up</h2>

      <h3>Design Decisions and Rationale</h3>
      
      <p>
        <b>Geospatial visualization:</b> With a focus on tracking disaster events over time across Japan, the interactive map allows users to witness the disasters by the prefectures they impacted. This helps track where and how major 
          natural disasters hit the country, such as the 2011 Japanese earthquakes, which had a high concentration in the northern region of Japan. To help viewers navigate through yearly profiles with ease, users may scroll through multiple years using a slider for the temporal animation with play/pause, prev, next buttons,
          or find country data for a specific year using the search bar.
        <br></br>
        <b>Previous alternatives:</b> We originally considered expanding our geospatial visualization globally and only tracking disaster locations and country risk profiles. However, this limited us to looking at countries’ disaster 
        data aggregates, giving us little flexibility to measure how, on a regional basis, countries were impacted by the aftermath of any given disaster event. As such, focusing on Japan specifically, a country with so many per-year disasters that have also historically been some of the most impactful worldwide, mitigated this issue and allowed 
        us to do a deeper dive into regional risk profile statistics to produce a more detailed and insightful visualization.
        <br></br>
        <b>Disaster points and filters:</b> To differentiate between disaster types, each was assigned a distinct color that appears on the map and their respective filtering boxes. Users may utilize these filters to easily select a subset of the
        disaster types for viewing across the time horizon.
        <br></br>
        <b>Impact Summary:</b> To let viewers see the exact dimensions of the damage resulting from a given disaster event, an on-hover tooltip was created that shows key statistics for a given disaster and prefecture affected that year, respectively.
        <br></br>
        <b>Risk Profile and Secondary Plot:</b> We sought to aggregate the various dimensions of the impact of a given disaster event on a given area by creating a risk estimate (risk profile) for said area. 
        This custom-built risk score balances economic and human impact scores for each disaster using weights that, after experimentation, seemed the most reasonable with regards to the accuracy with which they portray the likelihood that a given prefecture is to experience devastation. 
        The human impact score weighted deaths higher than individuals 'generally' affected to account for the indirect, but profound, the impact of death itself may have friends' and families' lives as well. 
        Each prefecture per year was then assigned once such risk estimate, and a color scale with percentile-based gradations was generated to allow for visual risk comparison across prefectures. 
        To let users track changes in risk profiles over time for a particular prefecture, we implemented logic triggered on-prefecture-click that generates
        a separate time-series plot the risk values of that prefecture across the entire time horizon.
        <br></br>
      </p>

      <h3>Development Process</h3>
      <p>
        Initially, most of the work was focused on finding the best way to visualize the NASA MODIS natural disaster data. As such, for the first 1.5 weeks, most of the work was done individually, with 
        each group member testing various modes of visualization using D3 to determine their respective capabilities of yielding the insights we wanted to see. We had 4 in-person/online meetings, two for initial brainstorming and two for working on our final 
        visualization. Our in-person meetings lasted for a minimum of 2 hours, allowing us to perform deep dives into our project's goals and for group coding/feedback. The dataset used to guide our final design was the MODIS Geocoded Disasters 
        (GDIS) dataset, which showcased global disasters over 60 years. But in order to see the scale of each disaster's impact we had to dig deeper and ended up with the EM-DAT dataset that GDIS is based on and that's where we managed to get the key damage values we needed. 
        With supplementary GeoJSON and population datasets, and a lot of preprocessing, we managed to create a final merged dataset for use in JS that contains exactly what is needed for the visualizations and nothing more.
        By this point the interactive map with the temporal animation and some basic styling on the page had already been implemented and confirmed operational, so the remaining tasks such as extra filtering, on-hover, on-click etc. were implementable in a completely modular fashion as those 2 components were their only prerequisites.
        Every team member completed their remaining tasks at their own pace, we fixed bugs as they popped up, and while debating the need for new features and filters, we ultimately were beholden to the deadline and ended our efforts satisfied with the result.
        <br></br>
        <h4>Workload Distribution:</h4>
        <b>Group:</b> Bug fixes, project planning, data fetching, risk profile, touch-ups.
        <br></br>
        <b>Uzair:</b> Data cleaning, preprocessing, automated secondary plot generation on-prefecture-click.
        <br></br>
        <b>Sean:</b> Rendering interactive map from GeoJSON, on-hover impact summary, on-click zoom animation.
        <br></br>
        <b>Uday:</b> Temporal animation using slider, buttons, disaster-type-based and year-based filtering.
        <br></br>
        <b>Odessa:</b> Disaster type differentiation using color coding, write-up.
        <br></br>
      </p>

      <h3>How we compute the Risk Profile</h3>
      <div id="risk-math"></div>
    </section>

    <!-- <div id="mj-test">\( \text{human\_burden},\; \text{econ\_burden},\; \text{damage}_{\$,\,\text{final}} \)</div> -->

  </div>

  <!-- Tooltip for D3 (same class name you had before) -->
  <div class="d3-tooltip" id="tooltip" style="display:none;"></div>
</body>

</html>
